---
import Layout from "../layouts/Layout.astro";
import CVResume from "../components/Resume.astro";
import BackToTop from "../components/BackToTop.astro";
import { getCollection } from "astro:content";

// Get the resume data with better error handling
let resume;
try {
    // First, try to get the collection - if this fails, it'll trigger the catch block
    const resumeCollection = await getCollection("resumes"); // Make sure this matches your config.ts
    console.log("Collection found, data:");

    if (resumeCollection && resumeCollection.length > 0) {
        resume = resumeCollection[0];
        console.log("Resume data found:");
    } else {
        console.error("No resume entries found in collection");
    }
} catch (error) {
    console.error("Error loading resume data:", error);
}
---

{
    resume ? (
        <Layout
            title={`${resume.data.basics.name} - CV`}
            description={`${resume.data.basics.name}, ${resume.data.basics.label}`}
        >
            <div class="py-8">
                <div class="mb-6 flex justify-between items-center">
                    <h1 class="text-5xl font-extrabold font-serif">CV</h1>
                    <a
                        class="flex gap-4"
                        href="/resume.pdf"
                        class="inline-flex items-center px-4 py-2 border
            border-transparent rounded-md shadow-sm text-sm font-medium
            text-white bg-blue-600 hover:bg-blue-700"
                    >
                        {"Download PDF "}
                    </a>
                </div>
            </div>

            <CVResume resume={resume.data} />

            <BackToTop />
        </Layout>
    ) : (
        <Layout
            title="Resume Not Found"
            description="Resume data could not be loaded"
        >
            <div class="py-8">
                <h1 class="text-5xl font-extrabold font-serif mb-4">Resume</h1>
                <div class="bg-red-50 border border-red-200 text-red-700 p-4 rounded-md">
                    <p>
                        Sorry, the resume data could not be loaded. Please check
                        the console for error details.
                    </p>
                </div>
            </div>
        </Layout>
    )
}
